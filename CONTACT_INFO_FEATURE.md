# 查询密钥功能说明

## 功能概述

为了让用户更方便地查询订单，系统新增了基于查询密钥的订单查询功能。用户在购买时可以设置一个查询密钥，后续可以通过这个密钥快速查询订单状态和获取卡密。

## 主要特性

### 1. 购买时设置查询密钥
用户在购买商品时需要设置：
- **查询密钥** (必填): 用户自定义的查询密码，6-20位字符

### 2. 多种查询方式
系统支持以下查询方式：
- **订单ID查询**: 传统的订单ID查询方式
- **查询密钥查询**: 通过购买时设置的查询密钥查询

### 3. 安全便捷
- 查询密钥是获取卡密的重要凭证
- 用户可以设置容易记住但安全的密钥
- 支持数字、字母、特殊字符组合

## 使用指南

### 购买流程

1. **选择商品**: 在商品列表中选择需要购买的商品
2. **设置查询密钥**: 
   - 必须设置查询密钥（6-20位字符）
   - 建议使用数字、字母组合，避免过于简单的密钥
   - 请务必记住您设置的查询密钥
3. **创建订单**: 点击"创建订单"按钮
4. **完成支付**: 扫描二维码完成USDT支付
5. **自动发货**: 支付成功后系统自动发放卡密

### 查询流程

#### 方式一：订单ID查询
1. 进入"查询订单"页面
2. 选择"订单ID查询"标签
3. 输入订单ID
4. 点击"查询订单"按钮

#### 方式二：查询密钥查询
1. 进入"查询订单"页面
2. 选择"查询密钥查询"标签
3. 输入购买时设置的查询密钥
4. 点击"查询订单"按钮

## 安全建议

### 查询密钥设置建议
- 使用6-20位字符
- 可以包含数字、字母、特殊字符
- 避免使用过于简单的组合（如：123456）
- 建议使用有意义但他人难以猜测的组合

### 信息保护
- 请妥善保管您的查询密钥
- 不要将查询密钥告诉他人
- 建议截图保存购买时设置的查询密钥

## 技术实现

### 后端API接口

#### 创建订单 (POST /api/payment/create)
```json
{
  "product": "商品名称",
  "type": "usdt",
  "queryKey": "查询密钥"
}
```

#### 查询密钥查询 (POST /api/payment/query-by-key)
```json
{
  "queryKey": "查询密钥"
}
```

### 数据库表结构

订单表新增字段：
- `query_key`: 查询密钥

相关索引：
- `idx_query_key`: 查询密钥索引

## 升级说明

### 数据库升级
如果您是从旧版本升级，请执行以下SQL语句：

```sql
-- 添加查询密钥字段
ALTER TABLE orders 
ADD COLUMN query_key VARCHAR(100) COMMENT '用户自定义查询密钥';

-- 添加索引
CREATE INDEX idx_query_key ON orders (query_key);
```

### 兼容性说明
- 新功能完全向后兼容
- 旧的订单ID查询方式仍然可用
- 已有订单的查询密钥字段为空，不影响正常使用

## 常见问题

### Q: 忘记了查询密钥怎么办？
A: 可以尝试使用订单ID查询，订单ID在购买成功后会显示。

### Q: 可以修改已提交订单的查询密钥吗？
A: 目前不支持修改已提交订单的查询密钥，请在购买时仔细设置。

### Q: 查询密钥区分大小写吗？
A: 是的，查询密钥区分大小写，请确保输入时大小写正确。

### Q: 查询密钥可以包含特殊字符吗？
A: 可以，查询密钥支持数字、字母、特殊字符的组合。

## 更新日志

### v1.1.0 (2024-12-19)
- 新增查询密钥功能
- 简化用户购买流程，只需设置查询密钥
- 优化查询界面，支持查询密钥查询
- 增强订单查询的便利性和安全性 